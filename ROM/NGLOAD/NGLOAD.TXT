
	◇＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝◇

		　　似非RAMシリーズ用　メガＲＯＭローダー

			  　NGLOAD.COM　ver 1.51e
						　  	 ｂｙ にが
	◇＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝◇


■　はじめに

	似非職人工房さんの開発した似非RAMシリーズにメガROMファイルを読み
	込ませてゲームカートリッジとして使うためのローダーです。本家の
	MGLOAD.COMと同じ趣旨ものですが、使い勝手を向上させています。

	1997年当時、バンクコンバートパッチ、スロット自動検索、裏ＲＡＭ
	ローダー、カーネル破壊防止などの機能を実装してリリースし、開発は
	終了していました。
	
	2016年に電子部品通販 M.A.D.の前田さんが似非RAM互換カートリッジを
	CPLDを使った新設計でリリースされました。その動作確認にて ver1.34に
	存在していたバグが明らかとなり、19年振りにUpdate。

	ver.1.40にてバグFIX+フラッシュROM対応としました。バグ内容はアスキー
	16kバンクの似非RAMを使った場合のスロット検索、および書き込み時に
	SRAM内容の1〜2バイトが破壊されていたもので、これを修正しました。

	2020年に新作「似非RAMDisk MAXIMUM」のリリースに合わせて4年ぶりに
	ver.1.50にUpdate。SUPER似非RAMDisk1/2のシステムインストールに対応し、
	スロット検索ルーチンを見直して安全性を向上するとともに、小さなバグを
	FIXしました。

 	2022年7月に似非音源シリーズのリリース似合わせてver.1.51dにUpdate。
	FlashROMに特殊なBIOS ROMを書き込んだ際にデータ化けが発生することが
	判明したため、原因となっていたFMSX98形式のROMヘッダのサポートを終了し、
	先頭1バイトへのROMヘッダ"AB"の強制書き込みを禁止しました。
	バンクレジスタ初期化のバグにより発生していた似非RAMDisk MAXIMUMへの
	書き込み時に発生していたデータ化けの問題もFIXしました。

	MGSP等容量が不定なROMファイルをロードする際に障害となっていたファイル
	サイズのチェックを撤廃し、ver.1.51eにUpdateしました。


■　特長

	★自動バンク形式コンバーター搭載
	
        メガＲＯＭファイルの拡張子さえ設定しておけば、自動的にそのファイル
        の形式を判断して、必要に応じてバンク形式のコンバートをします。


	★スロット自動検索機能（ver 1.34より）
	
	ロードしたいファイルを指定するだけで、自動的にそのＲＯＭファイルを再
	現するために最適な似非シリーズをスロットから検索してロードします。


	★MEGA-SCSIカーネル破壊防止機能（ver 1.04より）

	システムとして動作している似非シリーズには書き込みを拒否しますので、
	誤ってシステムを破壊して暴走させることはありません。


	★ソフトウエアリセット機能（ver 1.04より）
	
	ソフトウエアリセットの際にはバンクレジスタの初期化も行うため、単純な
	アスキー←→コナミ形式のコンバートで動作しなかったソフトのいくつかも
	動作します。


	★ダイレクト実行機能（ver 1.34より）
	
	似非にロードしたメガＲＯＭをリセットすること無しに直接実行できます。
	ターボＲなどの高速モードでメガＲＯＭを実行したいときに使えます。
	
	
	★標準ＲＯＭに対応（ver 1.34より）
	
	３２ｋバイト以下のＲＯＭファイルにも対応しました。本体内蔵ＲＡＭに
	ＲＯＭファイルをロードして実行することも出来ます。
	
	
	★海外バージョンパッチ内蔵
	
	お約束の海外バージョン改造パッチも内蔵しています。
	コナミのメガＲＯＭには、同一ＲＯＭに海外版を持っているものがいくつ
	かあり、パッチをあてることで、海外版でプレイすることが出来ます。そ
	の改造も、ロードするついでにできてしまいます。
	海外版では、タイトルロゴが変化したり、メッセージが英語になります。


	★FlashROMに対応（ver 1.40より）

	似非職人工房の似非ROMディスク、および海外のMEGA FlashROM SCCに対応
	しました。アスキーメガROMコントローラ（8kバンク、16kバンク）、および
	コナミの2212P003搭載のFlashROMカートリッジに対応しています。


	★SUPER似非RAMDiskに対応(ver 1.50cより）

	当方開発の新作カートリッジ「似非RAMDisk MAXIMUM」でRAMDisk容量1920kB
	を実現する「SUPER似非RAMDisk mode 1/2」へのシステムインストールに対応
	しました。mode1がNextor,mode2がMSX-DOS(2)用です。スロット検索にて自動
	認識されます。

	★似非SCC 1MB版に対応(ver 1.50dより）

	GALを使って製作された1MB版の似非SCCへのロードに対応しました。製作記事
	はLeftyServeにあります。


■　必要な物

	◇下記カートリッジのいずれか

	　似非RAMディスク、似非SCCディスク、
	　似非ROMディスク、MEGA FlashROM SCC
	　電子部品通販 M.A.D.さんの似非RAM互換カートリッジ「ZM-ER1K」
	　当方開発の「似非RAMDisk MAXIMUM」「似非ROM基板」「似非SDisk」など


	◇ＭＳＸ−ＤＯＳ（２）

	◇なんらかのＲＯＭファイル

　　※製品版のMEGA-SCSIでも動作が確認されています。しかし、WAVE-SCSIや、
　　　MEGA-SCCSIなど、個性的な似非シリーズでの動作は保証できません。

　　※CPLD版のMEGA FlashROM SCC+（プラスが付く方）シリーズには対応していない
　　　と思いますので注意してください。



■　使い方

◇１：ＲＯＭファイルをつじかわ氏のMGSAVEなどで作成します。

	メガＲＯＭファイルの拡張子を以下のように設定します。

	例）	ASCII   8K BANK : *.8K		(ascii 8K bank)
		ASCII  16K BANK : *.16K 	(ascii 16K bank)
		KONAMI SCC あり : *.SCK/SKN 	(SCc KoNami)
		KONAMI SCC なし : *.KNM 	(Konami NorMal)
		R-TYPE          : *.IRM         (IReM)

	最初の１文字のみで判定するので厳密に上記のようにする必要はありません。
	上はあくまでも設定例です。



◇２：ファイルをNGLOADを用いて似非にロードします。

	
	書式：　NGLOAD filename.ext [/Option1 /Option2 /....]
			NGLOAD vgm,rom /S83
              　~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

　　　ファイル名は必ず指定して下さい。指定がないと簡単な使い方を表示して停止
　　　します。スロット指定は省略可能です。


		◇ /S オプション：１６進数で記述します。

		似非の差さったスロットを指定します。省略時には、自動的に最適
		な似非シリーズをスロットから検索してロードしますので通常この
		オプションは不要です。

		＜基本スロット使用時＞
		SLOT#1:/S1
		SLOT#2:/S2
		SLOT#3:/S3

		＜拡張スロット使用時＞
		SLOT#0-0:/S80	#0-1:/S84	#0-2:/S88	#0-3:/S8C
		SLOT#1-0:/S81	#1-1:/S85	#1-2:/S89	#1-3:/S8D
		SLOT#2-0:/S82	#2-1:/S86	#2-2:/S8A	#2-3:/S8E
		SLOT#3-0:/S83	#3-1:/S87	#3-2:/S8B	#3-3:/S8F

		３２ｋバイト以下のファイルを指定したときにスロット指定を省略
		すると、ファイルを内蔵ＲＡＭにロードして直接実行します。拙作
		の標準ＲＯＭローダー「NSLOAD.COM」の裏ＲＡＭローダーと同等の
		機能ですので拡張ＢＡＳＩＣなどもＯＫです。

		◇ /F オプション：１６進数で記述します。

		対象がフラッシュROMと明示したいときに使います。必ずスロット
		指定してください。FlashROMチップに29F040を使っている場合のみ
		自動的に認識するのでこのオプション指定は不要です。
		/F1のようにFに引き続いてスロット番号を指定できます。/F /Sxx
		でも可。/Fxx /Sxxと両方指定した場合は/Sxxの番号が優先されます。

		◇ /O オプション：国外モードに改造

		国産ＭＳＸで実行すればＲＯＭゲームを海外版に改造します。海外
		ＭＳＸで実行すれば日本版に改造します。

		注意）ver 1.34以前はFオプションでしたが、フラッシュROM対応の
		ために /O (Overseas edition)に変更しました。

		◇ /R オプション：ソフトウエアリセット

		ロード後にソフトウエアリセットをかけます。単に、リセットボタ
		ンを押すだけとは異なる効果があります（後述）。


		◇ /E オプション：ダイレクト実行

		ロード後にリセットを経由せずに直接ＲＯＭをスタートします。
		ＣＰＵモード、クロックはロード時のままＲＯＭが起動します。



	例）スロット１の似非ＲＡＭに、ファイル名「NEMESIS3.SCK」をロードし、
	　　ついでに海外バージョンに改造し、リセットをかける。

			NGLOAD NEMESIS3.SCK /F /R
　　　　		~~~~~~~~~~~~~~~~~~~~~~~~~




■　諸注意

	似非ＲＡＭにゲームをロードすると、ＲＯＭヘッダが書き込まれるのでゲー
	ムしか立ち上がらなくなります。似非に起動しないスイッチを付けるか、
	後差しして対処して下さい。
	
	後差しするときは、ポーズボタンを押した状態で抜き差しすると、暴走す
	る確率が低くなります。
	
	
	８Ｋバンク（ASCII 8K , KONAMI）形式のファイルを１６Ｋバンクモードの
	似非でロードすることはできません。その逆もできません。
	
	
	コナミＳＣＣバンクからアスキー８Ｋバンクへのコンバートは、ほとんど
	成功しますが、その逆は必ずしも出来ません。これはメガＲＯＭコントロー
	ラのバンクレジスタ動作の違いによるものです。
	
	Ｒ−ＴＹＰＥをロードするときには３Ｍビット以上の１６ｋバンクに切り
	替えた似非ＲＡＭが必要です。Ｒ−ＴＹＰＥはバンクレジスタの初期値が
	特殊であるため、起動するためには/Rオプションでのソフトウエアリセット
	が必要です。なお、このローダーではＦＭ音源検索バグを直すパッチも当
	てられます。FM音源バグについての情報はれふてぃさんのサイトに詳しく
	書かれています。

	電子部品通販 M.A.D.さん開発の似非RAM互換カートリッジ「ZM-ER1K」や、
	当方開発の「似非RAMDisk MAXIMUM」にはバンクレジスタ初期値を設定でき
	るスイッチがあり、これをR-TYPEモードにすることで、/Rオプション無し
	でも起動できます。

	/Eオプションでのダイレクト実行が出来ないソフトもあります。暴走覚悟
	の上で指定して下さい（ｶﾞｰﾝ）。しかも、高速モードでも全然速くならな
	いソフトも多々ありますのであまり期待してはいけません（ｶﾞｰﾝ）。

	/Rオプションを指定すると、普通に起動しただけでは動かなかったソフト
	が動くようになることがあります。バンクレジスタの初期化をファイルの
	フォーマットに合わせて行うためです。Ｒ−ＴＹＰＥやソリッドスネーク
	を似非ＲＡＭで実行するときは指定すると起動することが知られています。

	カーネル破壊防止ルーチンにより、マスターカートリッジとして動作して
	いる似非シリーズには書き込めないようになっています。スレイブカート
	リッジには書き込めますが、/Rオプションを付ける必要があります。


	◇フラッシュROM対応について◇

	フラッシュROMは試し書きができないので、スロット上に存在しているか
	どうかをRAMやSRAMのように確認できません。似非ROMを読み込んだときの
	挙動はメガROMと同じですし、消去直後のフラッシュROMはデータをすべて
	FFhで返すので空きスロットと区別が付かなくなります。

	NGLOAD v1.40ではFlashROM 29F040に限り、JEDEC標準コマンドを通して
	デバイスID:A4hが確認できるか検索し、自動認識します。
	それ以外のフラッシュROMはJEDEC標準コマンドに対応しているものであれ
	ば/Fオプション指定にて消去・書き込みできる可能性がありますので試し
	てみてください。書き換え可能なのはコマンドアドレスが11bitのFlashROM
	のみです。コマンドに応答しない場合はエラーを出して終了します。

	フラッシュROMカートリッジのバンクタイプはSCC音源が載っている場合は
	8kバンクとして認識し、それ以外はバンクレジスタを操作したときの挙動
	を調べて自動認識しますが、メモリの内容が消去直後のように同じデータ
	で埋まっている場合は正しく認識できません。このような時はカートリッ
	ジタイプの表示が「ESE-ROM(?)」となります。空きスロットとの区別もで
	きないため、とりあえずJEDEC標準コマンドで消去を試み、消去成功した場
	合は読み込むファイルのバンク形式と合致しているという前提で処理します。

	フラッシュROMには書き換え寿命があり、意図せずに消去されると困ること
	もありそうなので、消去前に確認のためENTERキー入力待ちとなります。
	ENTER以外のキー押下でキャンセルします。


■　海外バージョンについて


	海外バージョンの改造は、コナミの数種類のソフトでのみ、成功が確認さ
	れています。コナミ以外のメーカーのものや、１６Ｋバンクのものでは、
	今のところ発見されていません。が、同一のルーチンが存在すれば書き換
	えがされるように作ってあります。もし以下のソフト以外で海外版の存在
	を発見したときには、ご報告をお願いします。


	■海外版改造に対応したソフト

	・グラディウス２
	・ゴーファーの野望 EPISODE 2
	・沙羅曼陀
	・グラディウス
	・夢大陸アドベンチャー
	・悪魔城ドラキュラ
	・ＵＳＡＳ
	・新１０倍カートリッジ
	・エルギーザの封印（ＭＳＸ１版）
	・魔城伝説II ガリウスの迷宮

	実行中のＭＳＸの国籍ＩＤを調べて、国産ＭＳＸなら、ゲームを欧州版に、
	海外ＭＳＸならゲームを日本版に書き換えます。






■　諸注意

	このソフトはフリーソフトウェアです。

	このソフトの使用は個人の責任において行って下さい。使用によって何らか
	の損害を生じた場合でも、当方は責任を負いかねます。

	個人的な配布や転載も自由ですが、なるべくバージョンアップがあった時は
	対応してください。あと、バグ情報など報告してくると助かります。

	配布に関わる費用での実費を越える徴収は控えてください。




■　謝辞2016-2022

	メガＲＯＭバックアップツール、並びに似非ＲＡＭの設計者つじかわさん、
	いろいろありがとうございます。勝手に似非シリーズを増やしていますが、		とりあえず黙認してくださっている模様。	
	ちなみにこのプログラムの骨子はMGLOAD.COMのパクリです(^^;。

	バージョンアップにご尽力頂いたﾐｶﾝ星人ﾌｧﾝさんには感謝です。ソフト
	ウエアリセットのルーチンや、諸々の技術情報を教えて頂いたお陰です。
	拡張スロットでの動作確認もどうもでした。2016年現在はｷﾌﾞﾝ豆乳ﾌｧﾝと
	してご健在のようで安心いたしました。

	海外バージョン対応ソフト情報をお寄せ頂いたよしまつＴＵＱさん、ありが
	とうございました。2016年現在もMSX研究所長としてご健在のようです。

	スロット＃０−１での動作報告をいただいためらまんさん、2015年にコンタ
	クトさせて頂きましたがご健在でした。その節はお世話になりました。

	電子部品通販 M.A.D.の前田さん、バグ報告と動作確認ありがとうございまし
	た。これからも素敵MSXハードに期待しています。

	Re:糠を足せ(仮)のmosakuさん、動作確認とご報告ありがとうございました。
	
	OKEIさん、どこでもセーブ機能の追加等はお任せします（無責任モード）

	ゆうくんさんのアイデアで似非RAMDisk MAXIMUMのSUPER似非RAMDiskモードが
	実現しました。ファイルシステムのDeepな知識をお持ちのOKEIさんとゆうくん
	さんがいればNextorも怖くない？　多大なご協力ありがとうございました。

	Mikasenさん、詳細なバグ報告ありがとうございました。隙のない動作検証に
	いつも助けられています。


■　終わりに

	2022年、似非シリーズはFM音源カートリッジに進出！





■　一次配布、および連絡先			にがHP on PS2Linux'

					website:http://niga2.sytes.net/
				にがBBS:http://niga2.sytes.net/bbs/upb.cgi

